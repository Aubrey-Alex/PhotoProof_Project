<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>验证结果 - 视频真实性验证系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <span class="navbar-brand mb-0 h1">视频真实性验证系统</span>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-8 mx-auto">
                <div class="card">
                    <div class="card-header">
                        <h5>验证结果</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>真实性判断</h6>
                                {% if result.is_authentic %}
                                    <div class="alert alert-success">
                                        <h4 class="alert-heading">✓ 视频真实</h4>
                                        <p>变换后的视频被确认为真实。</p>
                                    </div>
                                {% else %}
                                    <div class="alert alert-danger">
                                        <h4 class="alert-heading">✗ 视频可疑</h4>
                                        <p>变换后的视频未能通过真实性验证。</p>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <h6>详细指标</h6>
                                <table class="table table-sm">
                                    <tr>
                                        <td>相似度分数:</td>
                                        <td><strong>{{ "%.4f"|format(result.similarity_score) }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td>验证阈值:</td>
                                        <td>{{ "%.2f"|format(result.threshold) }}</td>
                                    </tr>
                                    <tr>
                                        <td>帧数匹配:</td>
                                        <td>
                                            {% if result.frame_count_match %}
                                                <span class="badge bg-success">是</span>
                                            {% else %}
                                                <span class="badge bg-danger">否</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>亮度变化:</td>
                                        <td>{{ "%.2f"|format(transform_params.brightness_change * 100) }}%</td>
                                    </tr>
                                    <tr>
                                        <td>旋转角度:</td>
                                        <td>{{ "%.1f"|format(transform_params.rotation_angle) }}°</td>
                                    </tr>
                                    <tr>
                                        <td>裁剪比例:</td>
                                        <td>{{ "%.1f"|format(transform_params.crop_ratio * 100) }}%</td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h6>算法说明</h6>
                            <p>系统使用多特征融合方法验证视频真实性：</p>
                            <ul>
                                <li><strong>SIFT特征：</strong>检测关键点，对旋转、缩放不变</li>
                                <li><strong>HSV直方图：</strong>颜色分布特征，对亮度变化鲁棒</li>
                                <li><strong>Hu矩：</strong>形状不变矩，对几何变换具有不变性</li>
                                <li><strong>频域特征：</strong>傅里叶变换特征，对空间变换鲁棒</li>
                            </ul>
                            <p>相似度分数基于这些特征的加权平均，阈值 0.6 表示中等保守的验证标准。</p>
                        </div>

                        <div class="mt-4">
                            <h6>视频对比</h6>

                            <div class="row">
                                <div class="col-md-6">
                                    <h6>原始视频</h6>
                                    <div class="alert alert-info">
                                        视频路径: /uploads/{{ filename }}
                                    </div>
                                    <video controls class="w-100" id="originalVideo">
                                        <source src="{{ url_for('uploaded_file', filename=filename) }}" type="video/mp4">
                                        您的浏览器不支持视频播放。
                                    </video>
                                    <!-- <div class="mt-2">
                                        <button onclick="testVideo('originalVideo')" class="btn btn-sm btn-secondary">测试播放</button>
                                        <span id="originalStatus"></span>
                                    </div> -->
                                </div>
                                <div class="col-md-6">
                                    <h6>变换后视频</h6>
                                    <div class="alert alert-info">
                                        视频路径: /uploads/{{ transformed_filename }}
                                    </div>
                                    <video controls class="w-100" id="transformedVideo">
                                        <source src="{{ url_for('uploaded_file', filename=transformed_filename) }}" type="video/mp4">
                                        您的浏览器不支持视频播放。
                                    </video>
                                    <!-- <div class="mt-2">
                                        <button onclick="testVideo('transformedVideo')" class="btn btn-sm btn-secondary">测试播放</button>
                                        <span id="transformedStatus"></span>
                                    </div> -->
                                </div>
                            </div>
                            
                            <!-- <script>
                                function testVideo(videoId) {
                                    const video = document.getElementById(videoId);
                                    const statusSpan = document.getElementById(videoId === 'originalVideo' ? 'originalStatus' : 'transformedStatus');

                                    video.onerror = function () {
                                        statusSpan.innerHTML = '<span class="text-danger">❌ 加载失败</span>';
                                        console.error('视频加载失败:', video.src);
                                    };

                                    video.onloadeddata = function () {
                                        statusSpan.innerHTML = '<span class="text-success">✅ 加载成功</span>';
                                    };

                                    video.load();
                                }
                            </script> -->

                        <div class="mt-4 text-center">
                            <a href="{{ url_for('index') }}" class="btn btn-primary">返回首页</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>